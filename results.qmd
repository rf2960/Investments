# Results

```{r}
install.packages("ggalluvial")
```


```{r}
library(tidyverse)
library(janitor)
library(lubridate)
library(scales)
library(GGally)
library(ggalluvial)

# Bigger, easy-to-read base font for all plots
theme_set(theme_minimal(base_size = 14))
```


```{r}
status_counts <- startup |> count(status)

gg_status_counts <- ggplot(status_counts,
       aes(x = status, y = n)) +
  geom_col(fill = "#4C72B0") +
  scale_y_continuous(labels = label_number(scale_cut = cut_si(""), accuracy = 1)) +
  labs(
    title    = "Most Startups in the Sample Are Still Operating",
    subtitle = "Count of startups by current Crunchbase status",
    x = NULL,
    y = "Number of startups"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_status_counts

```

```{r}
gg_funding_status <- startup |>
  filter(funding_total_usd > 0, !is.na(status)) |>
  ggplot(aes(x = status, y = funding_total_usd)) +
  geom_boxplot(fill = "#4C72B0", color = "black", outlier.alpha = 0.3) +
  scale_y_log10(
    labels = scales::label_number(
      prefix = "$",
      scale_cut = cut_si(""),   # converts 1000000 → 1M
      accuracy = 1
    ),
    breaks = c(1e5, 1e6, 1e7, 1e8, 1e9)
  ) +
  labs(
    title    = "Acquired Startups Tend to Raise More Money",
    subtitle = "Distribution of total funding by status (log scale)",
    x = NULL,
    y = "Total funding (USD, log scale)"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_funding_status

```

```{r}
top_markets <- startup |>
  count(market, sort = TRUE) |>
  slice_head(n = 15)

gg_top_markets <- ggplot(top_markets,
                         aes(x = reorder(market, n), y = n)) +
  geom_col(fill = "#4C72B0") +
  coord_flip() +
  scale_y_continuous(
    labels = label_number(
      scale_cut = cut_si(""),
      accuracy  = 1
    )
  ) +
  labs(
    title    = "Software and Biotech Dominate the Dataset",
    subtitle = "Top 15 markets by number of startups",
    x = NULL,
    y = "Number of startups"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_top_markets
```

```{r}
top_market_names <- top_markets$market

gg_market_status <- startup |>
  filter(market %in% top_market_names) |>
  count(market, status) |>
  group_by(market) |>
  mutate(prop = n / sum(n)) |>
  ggplot(aes(x = fct_reorder(market, prop),
             y = prop,
             fill = status)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = label_percent(accuracy = 1)) +
  labs(
    title    = "Most Markets Are Dominated by Operating Startups",
    subtitle = "Within each of the top 15 markets, share of startups by status",
    x = NULL,
    y = "Share of startups"
  ) +
  theme(
    plot.title   = element_text(face = "bold"),
    legend.title = element_blank()
  )

gg_market_status
```

```{r}
gg_founded_year <- startup |>
  filter(!is.na(founded_year)) |>
  count(founded_year) |>
  ggplot(aes(x = founded_year, y = n)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_y_continuous(
    labels = label_number(
      scale_cut = cut_si(""),
      accuracy  = 1
    )
  ) +
  labs(
    title    = "Startup Foundings Accelerated in the Mid-2000s",
    subtitle = "Number of startups founded by year",
    x = "Year founded",
    y = "Number of startups"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_founded_year
```

```{r}
gg_founded_status <- startup |>
  filter(!is.na(founded_year)) |>
  count(founded_year, status) |>
  group_by(founded_year) |>
  mutate(prop = n / sum(n)) |>
  ggplot(aes(x = founded_year, y = prop, fill = status)) +
  geom_area(alpha = 0.9) +
  scale_y_continuous(labels = label_percent(accuracy = 1)) +
  labs(
    title    = "Older Cohorts Have Had More Time to Be Acquired or Close",
    subtitle = "Share of startups with each outcome by founding year",
    x = "Year founded",
    y = "Share of startups"
  ) +
  theme(
    plot.title   = element_text(face = "bold"),
    legend.title = element_blank()
  )

gg_founded_status
```

```{r}
top_countries <- startup |>
  count(country_code, sort = TRUE) |>
  slice_head(n = 10)

gg_top_countries <- ggplot(top_countries,
                           aes(x = reorder(country_code, n), y = n)) +
  geom_col(fill = "#4C72B0") +
  coord_flip() +
  scale_y_continuous(
    labels = label_number(
      scale_cut = cut_si(""),
      accuracy  = 1
    )
  ) +
  labs(
    title    = "The United States Dominates the Sample",
    subtitle = "Top 10 countries by number of startups",
    x = "Country code",
    y = "Number of startups"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_top_countries
```

```{r}
gg_rounds_status <- startup |>
  filter(!is.na(funding_rounds), !is.na(status)) |>
  ggplot(aes(x = status, y = funding_rounds)) +
  geom_boxplot(fill = "#4C72B0", color = "black", outlier.alpha = 0.3) +
  labs(
    title    = "Acquired Startups Often Go Through More Rounds of Funding",
    subtitle = "Number of distinct funding rounds by status",
    x = NULL,
    y = "Number of funding rounds"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_rounds_status
```

```{r}
startup <- startup_raw |>
  clean_names() |>
  select(-starts_with("unnamed_")) |>
  distinct() |>
  mutate(
    status = fct_explicit_na(status, "unknown"),
    status = fct_relevel(status, "operating", "acquired", "closed", "unknown"),

    # Clean date-like variables — remove zero dates, empty strings, etc.
    founded_at = na_if(founded_at, "0000-00-00"),
    first_funding_at = na_if(first_funding_at, "0000-00-00"),

    founded_at = na_if(founded_at, ""),
    first_funding_at = na_if(first_funding_at, ""),

    # Convert to Date
    founded_at = ymd(founded_at, quiet = TRUE),
    first_funding_at = ymd(first_funding_at, quiet = TRUE)
  )


startup <- startup |>
  mutate(time_to_first_funding = as.numeric(first_funding_at - founded_at))

gg_time_to_funding <- startup |>
  filter(!is.na(time_to_first_funding),
         time_to_first_funding >= 0,
         time_to_first_funding <= 3650) |>  # cap at 10 years
  ggplot(aes(x = status, y = time_to_first_funding)) +
  geom_boxplot(fill = "#4C72B0", color = "black", outlier.alpha = 0.3) +
  labs(
    title    = "Time to First Funding Is Similar Across Outcomes",
    subtitle = "Days between founding date and first funding round",
    x = NULL,
    y = "Days from founding to first funding"
  ) +
  theme(
    plot.title = element_text(face = "bold")
  )

gg_time_to_funding
```

```{r}
# Get top 6 markets
top_markets <- startup |>
  count(market, sort = TRUE) |>
  slice_head(n = 6) |>
  pull(market)

mosaic_data <- startup |>
  filter(market %in% top_markets) |>
  mutate(
    market = fct_reorder(market, as.numeric(status), .fun = length, .desc = TRUE)
  ) |>
  select(market, status)

# Convert to contingency table
tbl <- table(mosaic_data$market, mosaic_data$status)

par(mar = c(6, 8, 6, 4))  

# Mosaic plot
mosaicplot(
  tbl,
  color = RColorBrewer::brewer.pal(n = ncol(tbl), "Set2"),
  main = "Outcome Mix Varies Across Major Startup Markets",
  xlab = "Market",
  ylab = "Proportion within Each Market",
  las = 2,
  cex.axis = 1.2
)

```

```{r}
startup_alluvial <- startup %>%
  filter(
    !is.na(founded_year),
    !is.na(funding_rounds),
    !is.na(status)
  ) %>%
  mutate(
    # group founding years into periods (tweak breaks/labels as you like)
    founded_period = cut(
      founded_year,
      breaks = c(1990, 2000, 2005, 2010, 2015, 2020),
      labels = c("1990–1999", "2000–2004", "2005–2008",
                 "2009–2011", "2012–2014"),
      include.lowest = TRUE,
      right = FALSE
    ),
    
    # bucket number of funding rounds
    rounds_bucket = case_when(
      funding_rounds == 0            ~ "0 rounds",
      funding_rounds == 1            ~ "1 round",
      funding_rounds %in% 2:3        ~ "2–3 rounds",
      funding_rounds >= 4            ~ "4+ rounds",
      TRUE                           ~ NA_character_
    )
  ) %>%
  drop_na(founded_period, rounds_bucket)

# (Optional) shrink sample so plot is not too dense
startup_alluvial_sample <- startup_alluvial %>% slice_sample(n = 5000)

gg_alluvial <- ggplot(
  startup_alluvial_sample,
  aes(
    axis1 = founded_period,
    axis2 = rounds_bucket,
    axis3 = status,
    y     = ..count..
  )
) +
  # flows
  geom_alluvium(aes(fill = status),
                width = 1/12, alpha = 0.7) +
  # blocks
  geom_stratum(width = 1/6, fill = "grey85", color = "grey40") +
  geom_text(stat = "stratum",
            aes(label = after_stat(stratum)),
            size = 3.5) +
  scale_x_discrete(
    limits = c("Founding period", "Funding rounds", "Status"),
    expand = c(.08, .08)
  ) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title    = "Funding Rounds and Outcomes Vary Across Startup Cohorts",
    subtitle = "Alluvial plot linking founding period, number of funding rounds, and final status",
    x        = NULL,
    y        = "Number of startups",
    fill     = "Status"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title   = element_text(face = "bold"),
    axis.text.x  = element_text(size = 12),
    legend.title = element_blank()
  )

gg_alluvial
```

```{r}
startup_facet <- startup |>
  filter(funding_total_usd > 0, !is.na(funding_rounds), !is.na(status)) |>
  mutate(
    rounds_bucket = case_when(
      funding_rounds == 0       ~ "0 rounds",
      funding_rounds == 1       ~ "1 round",
      funding_rounds %in% 2:3   ~ "2–3 rounds",
      funding_rounds >= 4       ~ "4+ rounds",
      TRUE                      ~ NA_character_
    ),
    rounds_bucket = factor(
      rounds_bucket,
      levels = c("0 rounds", "1 round", "2–3 rounds", "4+ rounds")
    )
  ) %>%
  drop_na(rounds_bucket)

gg_facet_funding_rounds <- ggplot(
  startup_facet,
  aes(x = rounds_bucket, y = funding_total_usd)
) +
  geom_boxplot(fill = "#4C72B0", color = "black", outlier.alpha = 0.3) +
  scale_y_log10(
    labels = label_number(
      prefix    = "$",
      scale_cut = cut_si(""),  # 1e6 -> $1M
      accuracy  = 1
    )
  ) +
  facet_wrap(~ status, ncol = 2) +
  labs(
    title    = "More Funding Rounds Are Associated with Larger Total Investments",
    subtitle = "Distribution of total funding by number of rounds, shown separately for each outcome",
    x        = "Number of funding rounds",
    y        = "Total funding (USD, log scale)"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title   = element_text(face = "bold"),
    axis.text.x  = element_text(angle = 0),
    legend.position = "none"
  )

gg_facet_funding_rounds

```

```{r}
startup_year_status <- startup %>%
  filter(!is.na(founded_year), status != "unknown") %>%
  count(status, founded_year)

gg_facet_year_status <- ggplot(
  startup_year_status,
  aes(x = founded_year, y = n)
) +
  geom_col(fill = "#4C72B0") +
  facet_wrap(~ status, ncol = 2, scales = "free_y") +
  labs(
    title    = "Startup Founding Trends Differ Across Outcomes",
    subtitle = "Number of startups founded per year, separated by final status",
    x        = "Year founded",
    y        = "Number of startups"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title  = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

gg_facet_year_status

```

